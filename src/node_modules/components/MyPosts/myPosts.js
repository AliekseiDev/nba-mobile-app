import React, { Component } from 'react';

import MyPostsTemplate from './myPostsTemplate';
import Loading from 'components/Loading';

import style from './myPosts.css';
import { actions } from '_firebase';

class MyPosts extends Component {

  state = {
    posts: [],
    fetching: true,
  }

  componentDidMount = async () => {
    let posts = await actions.getUserPosts();
    this.setState({posts, fetching: false});
  }

  deleteArticle = async (type, article) => {
    let index = this.state.posts.findIndex((item) => item._id === article._id);
    this.setState(prevState => {
      prevState.posts[index].loading = true;
      return prevState;
    });
    await actions.deleteArticle(type, article);
    this.setState(prevState => {
      prevState.posts = prevState.posts.filter((item) => item._id !== article._id);
      return prevState;
    });
  }

  render() {
    return (
      this.state.fetching ?
        <div className={style.loading}><Loading/></div>
      :
        (!this.state.fetching && !this.state.posts.length) ?
          <h4 style={{padding: '15px'}}>
            No content found
          </h4>
        :
        <MyPostsTemplate
          deleteArticle={this.deleteArticle}
          posts={this.state.posts}
        />
    );
  }
}

export default MyPosts;